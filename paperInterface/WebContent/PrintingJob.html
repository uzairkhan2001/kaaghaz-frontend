<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Receive From Printing</title>
  
  <link rel="stylesheet" href="syles.css">
  <style>
    body{
      margin: 0%;
      padding: 0%;
    }
    * {
          box-sizing: border-box;
     }
     .tble{
    font-family: 'Montserrat', sans-serif;  
      text-align: center;  
      background-color: rgb(63,72,83);  
      font-family: sans-serif;  
      color: rgb(5, 5, 5);  
      overflow-x: hidden;  
}
.topnav {
  overflow: hidden;
  background-color: #333;
}

.topnav a {
  float: left;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 20px;
}

.topnav a:hover {
  background-color: #ddd;
  color: black;
}

.topnav a.active {
  background-color: #03e9f4;
  color: black;

}   
</style>
</head>
<body>
<div class="topnav">
    <a class="active" href="http://localhost:8080/paperInterface/homepage.html">Home</a>
    <a href="http://localhost:8080/paperInterface/recieveorder.html">Inventory</a>
    <a href="http://localhost:8080/paperInterface/purchases.html">Purchases</a>
    <a href="#about">About</a>
</div>
<div class="RepoBtns">
  <button class = 'btn' type="button" onclick="history.back()">BACK</button>
  <h2>INVENTORY REPORT</h2>

</div>
<div class="tble">
<h1 class="head1">Received Printing Job</h1>
<table class="tableData">  
  <thead>  
    <tr>  
      <th> Printing ID </th> 
      <th> Raw Material </th> 
      <th> Size </th>  
      <th> Weight </th>  
      <th> Vendor </th>  
      <th> Total Quantity </th>  
      <th> Received Quantity </th>  
      <th> Remaining Quantity </th> 
      <th> Status </th>  
    </tr>   
  </thead> 
  <tbody id = "receivePrintingRecords"> </tbody>  
  
</table>
 <div class="loginPopup">
  <div class="formPopup" id="popupForm">
  </div>
</div>
<label class="lbl" hidden="hidden">Please Insert Valid Quantity!</label>
</div>
</body>
<script type="text/javascript">
var parseXML;
if (typeof window.DOMParser != "undefined") {
 parseXML = function(xmlStr) {
 return ( new window.DOMParser() ).parseFromString(xmlStr, "text/xml");
 };
} else if (typeof window.ActiveXObject != "undefined" &&
 new window.ActiveXObject("Microsoft.XMLDOM")) {
 parseXML = function(xmlStr) {
 var xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
 xmlDoc.async = "false";
 xmlDoc.loadXML(xmlStr);
 return xmlDoc;
 };
} else {
 throw new Error("No XML parser found");
}

window.onload = (e) =>{
	console.log("Page has been loaded");
	
	getReceivePrinitng();
}
function getReceivePrinitng(){
	var myHeaders = new Headers();
myHeaders.append("SOAPAction", "\"\"");
myHeaders.append("Content-Type", "application/xml");

var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    <Body>
        <getAllReceivePrinting xmlns="http://mainpkg"/>
    </Body>
</Envelope>`

var requestOptions = {
  method: 'POST',
  headers: myHeaders,
  body: raw,
  redirect: 'follow'
};

fetch("http://localhost:8080/paper/services/GetAllReceivePrinting", requestOptions)
  .then(response => response.text())
	  .then(result =>  {
			
		  var xml = parseXML(result);
		  var tbody = document.getElementById('receivePrintingRecords');
		  var numberOfRecords = xml.getElementsByTagName('getAllReceivePrintingReturn').length;
		
		  for(i = 0; i < numberOfRecords; i++){
			  
			  	var printId = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[0].childNodes[0].nodeValue;
					var purchaseID = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[1].childNodes[0].nodeValue;
          var raw = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[2].childNodes[0].nodeValue;
          var size = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[3].childNodes[0].nodeValue;
					var weight = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[4].childNodes[0].nodeValue;
					var vendor = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[5].childNodes[0].nodeValue;
					var total_Quan = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[6].childNodes[0].nodeValue;
					var receive_Quan = xml.getElementsByTagName('getAllReceivePrintingReturn')[i].childNodes[7].childNodes[0].nodeValue;
					var remain_Quan = total_Quan - receive_Quan;
          
					
					additem(printId,purchaseID,raw,size,weight,vendor,total_Quan,receive_Quan,remain_Quan,purchaseID,printId);
		  }
	  })
	  .catch(error => console.log('error', error));
}

function additem(printId,purchaseID,raw,size,weight,vendor,total_Quan,receive_Quan,remain_Quan,purchaseID,printId){

  var tbody = document.getElementById('receivePrintingRecords');

  let br = document.createElement("br");
  let br1 = document.createElement('br');
  let br2 = document.createElement('br');
  let br3 = document.createElement('br');
  let br4 = document.createElement('br');

	let trow=document.createElement("tr");
	let td1=document.createElement('td');
	let td2=document.createElement('td');
	let td3=document.createElement('td');
	let td4=document.createElement('td');
	let td5=document.createElement('td');
	let td6=document.createElement('td');
	let td7=document.createElement('td');
 	let td8=document.createElement('td');
  let td9=document.createElement('td');
  let td10=document.createElement('td')
  
	td1.innerHTML="PID"+purchaseID+" - PRID"+printId;
	td2.innerHTML=raw;
  td3.innerHTML=size;
	td4.innerHTML=weight;
	td5.innerHTML=vendor;
	td6.innerHTML=total_Quan;
	td7.innerHTML=receive_Quan;
	td8.innerHTML=remain_Quan;
  td8.setAttribute("id","rem" + purchaseID + "pri" + printId);
  
  
	trow.appendChild(td1);
	trow.appendChild(td2);
	trow.appendChild(td3);
	trow.appendChild(td4);
	trow.appendChild(td5);
	trow.appendChild(td6);
	trow.appendChild(td7);
  trow.appendChild(td8);

  var buttonText;

  if(remain_Quan == 0)
  {
    td9.innerHTML = "COMPLETED!";
    td9.setAttribute("style", "color: #26c406;");
    td9.style.fontWeight= "bold"
  }
  
  else
  {  if (remain_Quan < total_Quan)
    {
      buttonText = "Receive More";
    }
   else
    {
      buttonText = "Receive";
    }

    let tdbutton = document.createElement('button');
    tdbutton.innerText = buttonText;
    tdbutton.setAttribute("id","rcv" + purchaseID);
    tdbutton.setAttribute("onCLick", "openForm(this.id)");
    tdbutton.setAttribute("style", "background-color: #26c406;");
    tdbutton.setAttribute("class", "edit");
    td9.appendChild(tdbutton);
  }

  let tdbutton2 = document.createElement('button');
    tdbutton2.innerText ="View History";
    tdbutton2.setAttribute("id",purchaseID);
    tdbutton2.setAttribute("onCLick", "redirect(http://localhost:8080/paperInterface/Reports.html)");
    tdbutton2.setAttribute("style", "background-color: #cf7d11;");
    tdbutton2.setAttribute("class", "edit");


    // let tdbutton3 = document.createElement('button');
    // tdbutton3.innerText ="Place Printing";
    // tdbutton3.setAttribute("id",purchaseId);
    // tdbutton3.setAttribute("onCLick", "openPrintForm()");
    // tdbutton3.setAttribute("style", "background-color: #26c406;");
    // tdbutton3.setAttribute("class", "edit");

    // td9.appendChild(br1);
    // td9.appendChild(br2);
    // td9.appendChild(tdbutton3);

    td9.appendChild(br3);
    td9.appendChild(br4);
    td9.appendChild(tdbutton2);

  trow.appendChild(td9);
  tbody.appendChild(trow);
	tbody.appendChild(br);
}

</script>
</html>
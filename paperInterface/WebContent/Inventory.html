<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<link rel="stylesheet" href="syles.css">
    <style> 
        body{
        margin: 0%;
        padding: 0%;
        }
        *{
              box-sizing: border-box;
         }
          
        .bdy    {  
          font-family: 'Montserrat', sans-serif;  
          text-align: center;  
          background-color: rgb(63,72,83);  
          font-family: sans-serif;  
          color: rgb(5, 5, 5);  
          overflow-x: hidden;  
        } 
        .topnav {
  overflow: hidden;
  background-color: #333;
}

.topnav a {
  float: left;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 20px;
}

.topnav a:hover {
  background-color: #ddd;
  color: black;
}

.topnav a.active {
  background-color: #03e9f4;
  color: black;

} 
    </style>
    <title>Summary</title>
</head>
<body>
    <div class="topnav">
        <a href="http://localhost:8080/paperInterface/homepage.html">Home</a>
        <a class="active" href="http://localhost:8080/paperInterface/recieveorder.html">Inventory</a>
        <a href="http://localhost:8080/paperInterface/purchases.html">Purchases</a>
        <a href="#about">About</a>
    </div>
<div class="bdy">
<div class="RepoBtns">
    <button class = 'btn' type="button" onclick="history.back()">BACK</button>
    <h2>INVENTORY REPORT</h2>

</div>
<br>
<br>
<div class="user-box">
    <label>Category:</label>
    <br> <br> 
    <select id="Category" onchange="getSummary()">
        <option value="0">Select a category</option>
        <option value="1">Paper</option>
        <option value="2">Title Card</option>
        <option value="3">Separator Card</option>
    </select>
</div>
<div id = "ROReportbypid">
    <h1 class="head1">SUMMARY</h1>
    <table class="tableData">  
        <thead>  
            <tr>  
                <th> Size </th> 
                <th> Weight </th>  
                <th> Intact Quantity </th>
                <th> Damage Quantity </th>
            </tr>   
        </thead> 
        <tbody id = "summary"></tbody>  
    </table>
</div>    
</body>
<script type="text/javascript">

    var parseXML;
    if (typeof window.DOMParser != "undefined") {
     parseXML = function(xmlStr) {
     return ( new window.DOMParser() ).parseFromString(xmlStr, "text/xml");
     };
    } else if (typeof window.ActiveXObject != "undefined" &&
     new window.ActiveXObject("Microsoft.XMLDOM")) {
     parseXML = function(xmlStr) {
     var xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
     xmlDoc.async = "false";
     xmlDoc.loadXML(xmlStr);
     return xmlDoc;
     };
    } else {
     throw new Error("No XML parser found");
    }
    
    window.onload = (e) =>{
        console.log("Page has been loaded");
        //getSummary();
    }

    function removeRows() {
      var table = document.getElementById("summary");
      var rowCount = table.rows.length;
      // Start from the last row to avoid issues with changing indices.
      for (var i = rowCount - 1; i >= 0; i--) {
        table.deleteRow(i);
      }
      table.innerHTML = table.innerHTML.replace(/<br>/g, "");
    }

function getSummary(){
    removeRows();
    var e = document.getElementById('Category')
    var category = e.options[e.selectedIndex].text
    var myHeaders = new Headers();
    myHeaders.append("SOAPAction", "\"\"");
    myHeaders.append("Content-Type", "application/xml");

var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    <Body>
        <getSummaryOfRawMaterial xmlns="http://mainpkg">
            <raw>${category}</raw>
        </getSummaryOfRawMaterial>
    </Body>
</Envelope>`;

var requestOptions = {
  method: 'POST',
  headers: myHeaders,
  body: raw,
  redirect: 'follow'
};

fetch("http://localhost:8080/paper/services/GetSummaryOfRawMaterial", requestOptions)
  .then(response => response.text())
  .then(result =>  {
			
            var xml = parseXML(result);
            var tbody = document.getElementById('summary');
            var numberOfRecords = xml.getElementsByTagName('getSummaryOfRawMaterialReturn').length;
          
            for(i = 0; i < numberOfRecords; i++){
                
                    var raw = xml.getElementsByTagName('getSummaryOfRawMaterialReturn')[i].childNodes[0].childNodes[0].nodeValue;
                      var size = xml.getElementsByTagName('getSummaryOfRawMaterialReturn')[i].childNodes[1].childNodes[0].nodeValue;
                      var weight = xml.getElementsByTagName('getSummaryOfRawMaterialReturn')[i].childNodes[2].childNodes[0].nodeValue;
                      var receive_Quan = xml.getElementsByTagName('getSummaryOfRawMaterialReturn')[i].childNodes[3].childNodes[0].nodeValue;
                      var damage_Quan = xml.getElementsByTagName('getSummaryOfRawMaterialReturn')[i].childNodes[4].childNodes[0].nodeValue;
                      var print_Quan = xml.getElementsByTagName('getSummaryOfRawMaterialReturn')[i].childNodes[5].childNodes[0].nodeValue;
             
            var remain_Quan = receive_Quan - print_Quan;
  
                      additem(size,weight,remain_Quan,damage_Quan);
            }
        })
  .catch(error => console.log('error', error));
}
function additem(size,weight,remain_Quan,damage_Quan){

var tbody = document.getElementById('summary');

let br = document.createElement("br");

  let trow=document.createElement("tr");
  let td1=document.createElement('td');
  let td2=document.createElement('td');
  let td3=document.createElement('td');
  let td4=document.createElement('td');
  
  td1.innerHTML=size;
  td2.innerHTML=weight;
  td3.innerHTML=remain_Quan;
  td4.innerHTML=damage_Quan;

  trow.appendChild(td1);
  trow.appendChild(td2);
  trow.appendChild(td3);
  trow.appendChild(td4);
  tbody.appendChild(trow);
  tbody.appendChild(br);
}
</script>
</html>